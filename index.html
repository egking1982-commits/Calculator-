<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALRHAB | Ø§Ù„Ø±Ø­Ø§Ø¨ - Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ø°ÙƒÙŠ</title>
    
    <link rel="manifest" href="manifest.json">
    
    <link rel="apple-touch-icon" href="1000348870.png">
    <link rel="icon" type="image/png" href="1000348870.png">
    
    <meta name="theme-color" content="#d4af37">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <style>
        :root {
            --gold: #d4af37;
            --white: #ffffff;
            --glass: rgba(0, 0, 0, 0.4);
            --bg-overlay: rgba(0, 0, 0, 0.3);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
            /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø±ÙÙ‚Ø© */
            background: url('https://i.ibb.co/LzfMvS7/1000348849.jpg') no-repeat center center fixed;
            background-size: cover;
            color: var(--white);
            overflow: hidden;
        }

        .overlay { position: absolute; inset: 0; background: var(--bg-overlay); z-index: 1; }

        .app-card {
            position: relative; z-index: 10;
            width: 95%; max-width: 450px; height: 92vh;
            background: rgba(0, 30, 45, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--gold);
            border-radius: 30px;
            padding: 15px;
            display: flex; flex-direction: column;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }

        .app-logo {
            text-align: center; font-size: 1.8rem; font-weight: bold;
            color: var(--gold); letter-spacing: 3px; margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .calendar-bar {
            background: var(--glass); border-radius: 15px; padding: 8px;
            margin-bottom: 12px; text-align: center; border: 1px solid rgba(212, 175, 55, 0.3);
        }
        .calendar-bar .hijri { color: var(--gold); font-weight: bold; font-size: 0.9rem; }

        .tabs { display: flex; justify-content: space-around; gap: 4px; margin-bottom: 15px; flex-shrink: 0; }
        .tab-btn {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.1); padding: 8px 2px;
            border-radius: 10px; color: white; cursor: pointer; transition: 0.3s; flex: 1; font-size: 0.75rem;
        }
        .tab-btn.active { background: var(--gold); color: black; font-weight: bold; border-color: var(--gold); }

        .section { display: none; flex-grow: 1; overflow-y: auto; padding-right: 5px; }
        .section.active { display: block; }

        /* Ø³ØªØ§ÙŠÙ„Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ù…Ø·ÙˆØ± */
        .download-status { font-size: 0.75rem; text-align: center; margin-bottom: 5px; color: var(--gold); }
        .audio-player { width: 100%; height: 35px; margin-top: 10px; border-radius: 10px; }
        
        .prayer-time-card { background: var(--glass); border-radius: 15px; padding: 12px 20px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(212, 175, 55, 0.2); }
        .prayer-name { font-weight: bold; color: var(--gold); }
        
        .ayah-card, .azkar-card { background: rgba(0,0,0,0.4); border-radius: 10px; padding: 15px; margin-bottom: 10px; line-height: 1.8; font-size: 1.1rem; text-align: center; border-right: 4px solid var(--gold); }
        .azkar-card .count-badge { display: inline-block; background: var(--gold); color: black; padding: 2px 10px; border-radius: 10px; font-size: 0.8rem; margin-top: 10px; font-weight: bold; }

        .counter-circle { width: 140px; height: 140px; border-radius: 50%; margin: 15px auto; border: 5px double var(--gold); display: flex; flex-direction: column; justify-content: center; cursor: pointer; background: var(--glass); text-align: center; }
        .count-num { font-size: 2.8rem; font-weight: bold; }

        .compass { width: 180px; height: 180px; border-radius: 50%; border: 4px solid var(--gold); margin: 30px auto; position: relative; background: var(--glass); }
        .kaaba-icon { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); font-size: 2rem; }
        .needle { position: absolute; top: 50%; left: 50%; width: 4px; height: 70px; background: var(--gold); transform-origin: bottom center; transform: translate(-50%, -100%); }

        select, input { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--gold); background: rgba(0,0,0,0.7); color: white; margin-bottom: 10px; outline: none; box-sizing: border-box; }
        .btn { background: var(--gold); border: none; padding: 10px; border-radius: 10px; color: black; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; }
        .btn:active { transform: scale(0.95); }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #111; padding: 25px; border-radius: 20px; width: 280px; border: 1px solid var(--gold); text-align: center; }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }
    </style>
</head>
<body>

<div class="overlay"></div>

<div class="app-card">
    <div class="app-logo">ALRHAB</div>
    
    <div class="calendar-bar">
        <span class="hijri" id="hijriDate">...</span>
        <span id="gregorianDate"></span>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('tasbih', this)">ØªØ³Ø¨ÙŠØ­</button>
        <button class="tab-btn" onclick="switchTab('azkar', this)">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</button>
        <button class="tab-btn" onclick="switchTab('prayer', this)">Ø§Ù„ØµÙ„Ø§Ø©</button>
        <button class="tab-btn" onclick="switchTab('quran', this)">Ø§Ù„Ù…ØµØ­Ù</button>
        <button class="tab-btn" onclick="switchTab('qibla', this)">Ø§Ù„Ù‚Ø¨Ù„Ø©</button>
    </div>

    <div id="tasbihSection" class="section active">
        <select id="zikrSelect" onchange="loadZikr()"></select>
        <div class="counter-circle" onclick="handleTap()">
            <span class="count-num" id="display">0</span>
            <span style="font-size: 0.7rem; color: var(--gold);" id="goalDisplay">Ø§Ù„Ù‡Ø¯Ù: 33</span>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
            <button class="btn" onclick="openModal()">+ Ø°ÙƒØ± Ø¬Ø¯ÙŠØ¯</button>
            <button class="btn" style="background:var(--glass); color:white; border:1px solid var(--gold)" onclick="deleteZikr()">Ø­Ø°Ù</button>
            <button class="btn" style="grid-column: span 2; background:var(--glass); color:white; border:1px solid var(--gold)" onclick="resetCounter()">ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯</button>
        </div>
    </div>

    <div id="azkarSection" class="section">
        <select id="azkarCategory" onchange="loadAzkar(this.value)">
            <option value="morning">Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­</option>
            <option value="evening">Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡</option>
            <option value="sleep">Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…</option>
        </select>
        <div id="azkarContainer"></div>
    </div>

    <div id="prayerSection" class="section">
        <div id="prayerTimesContainer"></div>
        <p style="font-size: 0.7rem; text-align: center; margin-top: 10px; opacity: 0.7;">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…ÙØ¹Ù„Ø©</p>
    </div>

    <div id="quranSection" class="section">
        <select id="surahSelect" onchange="loadSurah(this.value)">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©...</option>
        </select>
        <div id="offlineControls" style="display:none; background: var(--glass); padding: 10px; border-radius: 15px; margin-bottom: 10px;">
            <div id="dlStatus" class="download-status">Ù…ØªÙˆÙØ±Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div>
            <button id="dlBtn" class="btn" style="width:100%; font-size:0.8rem;">ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ø£ÙˆÙÙ„Ø§ÙŠÙ† â¬‡ï¸</button>
            <div id="audioPlayerContainer"></div>
        </div>
        <div id="quranContent"></div>
    </div>

    <div id="qiblaSection" class="section">
        <div class="compass" id="compassRing">
            <div class="kaaba-icon">ğŸ•‹</div>
            <div class="needle"></div>
        </div>
        <p style="text-align:center; font-size:0.8rem; margin-top:10px;">Ø¶Ø¹ Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø´ÙƒÙ„ Ù…Ø³Ø·Ø­</p>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <input type="text" id="nameInp" placeholder="Ø§Ø³Ù… Ø§Ù„Ø°ÙƒØ±">
        <input type="number" id="goalInp" placeholder="Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ù‚Ù…ÙŠ">
        <button class="btn" style="width:100%; margin-bottom:5px;" onclick="addZikr()">Ø­ÙØ¸</button>
        <button class="btn" style="width:100%; background:#444; color:white" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<script>
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ù„ØªÙ…ÙƒÙŠÙ† ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('SW Registered'))
                .catch(err => console.log('SW Error', err));
        });
    }

    const CACHE_NAME = 'alrhab-offline-v1';
    let azkarList = JSON.parse(localStorage.getItem('alrhab_tasbih')) || [{ name: "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡", count: 0, goal: 33 }];
    let idx = 0;

    const azkarData = {
        morning: [
            { t: "Ø£ØµØ¨Ø­Ù†Ø§ ÙˆØ£ØµØ¨Ø­ Ø§Ù„Ù…Ù„Ùƒ Ù„Ù„Ù‡ØŒ ÙˆØ§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙˆÙ„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ­Ø¯Ù‡ Ù„Ø§ Ø´Ø±ÙŠÙƒ Ù„Ù‡", c: 1 },
            { t: "Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ: Ø§Ù„Ù„Ù‘ÙÙ‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ù‘ÙØ§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙ‘Ù Ø§Ù„Ù’Ù‚ÙÙŠÙ‘ÙÙˆÙ…Ù...", c: 1 },
            { t: "ÙŠØ§ Ø­ÙŠ ÙŠØ§ Ù‚ÙŠÙˆÙ… Ø¨Ø±Ø­Ù…ØªÙƒ Ø£Ø³ØªØºÙŠØ« Ø£ØµÙ„Ø­ Ù„ÙŠ Ø´Ø£Ù†ÙŠ ÙƒÙ„Ù‡ ÙˆÙ„Ø§ ØªÙƒÙ„Ù†ÙŠ Ø¥Ù„Ù‰ Ù†ÙØ³ÙŠ Ø·Ø±ÙØ© Ø¹ÙŠÙ†", c: 1 },
            { t: "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡", c: 100 }
        ],
        evening: [
            { t: "Ø£Ù…Ø³ÙŠÙ†Ø§ ÙˆØ£Ù…Ø³Ù‰ Ø§Ù„Ù…Ù„Ùƒ Ù„Ù„Ù‡ØŒ ÙˆØ§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙˆÙ„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ­Ø¯Ù‡ Ù„Ø§ Ø´Ø±ÙŠÙƒ Ù„Ù‡", c: 1 },
            { t: "Ø§Ù„Ù„Ù‡Ù… Ø¨Ùƒ Ø£Ù…Ø³ÙŠÙ†Ø§ØŒ ÙˆØ¨Ùƒ Ø£ØµØ¨Ø­Ù†Ø§ØŒ ÙˆØ¨Ùƒ Ù†Ø­ÙŠØ§ØŒ ÙˆØ¨Ùƒ Ù†Ù…ÙˆØªØŒ ÙˆØ¥Ù„ÙŠÙƒ Ø§Ù„Ù…ØµÙŠØ±", c: 1 },
            { t: "Ø£Ø¹ÙˆØ° Ø¨ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù„Ù‡ Ø§Ù„ØªØ§Ù…Ø§Øª Ù…Ù† Ø´Ø± Ù…Ø§ Ø®Ù„Ù‚", c: 3 }
        ],
        sleep: [
            { t: "Ø¨Ø§Ø³Ù…Ùƒ Ø±Ø¨ÙŠ ÙˆØ¶Ø¹Øª Ø¬Ù†Ø¨ÙŠ ÙˆØ¨Ùƒ Ø£Ø±ÙØ¹Ù‡ØŒ Ø¥Ù† Ø£Ù…Ø³ÙƒØª Ù†ÙØ³ÙŠ ÙØ§Ø±Ø­Ù…Ù‡Ø§", c: 1 },
            { t: "Ø§Ù„Ù„Ù‡Ù… Ù‚Ù†ÙŠ Ø¹Ø°Ø§Ø¨Ùƒ ÙŠÙˆÙ… ØªØ¨Ø¹Ø« Ø¹Ø¨Ø§Ø¯Ùƒ", c: 3 },
            { t: "Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ø®Ù„Ø§Øµ ÙˆØ§Ù„Ù…Ø¹ÙˆØ°ØªÙŠÙ†", c: 3 }
        ]
    };

    function init() {
        updateCalendar();
        renderSelect();
        loadSurahList();
        loadPrayerTimes();
        setupCompass();
        requestNotificationPermission();
        loadAzkar('morning');
    }

    function switchTab(tab, btn) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tab + 'Section').classList.add('active');
        btn.classList.add('active');
    }

    function loadAzkar(cat) {
        const container = document.getElementById('azkarContainer');
        let html = "";
        azkarData[cat].forEach(item => {
            html += `<div class="azkar-card">${item.t}<br><span class="count-badge">Ø§Ù„ØªÙƒØ±Ø§Ø±: ${item.c}</span></div>`;
        });
        container.innerHTML = html;
    }

    function requestNotificationPermission() {
        if ("Notification" in window) Notification.requestPermission();
    }

    function scheduleNotification(name, time) {
        const [hours, minutes] = time.split(':');
        const now = new Date();
        const prayerTime = new Date();
        prayerTime.setHours(hours, minutes, 0);
        if (prayerTime > now) {
            const timeout = prayerTime.getTime() - now.getTime();
            setTimeout(() => { new Notification("Ø­Ø§Ù† ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©", { body: `Ø£Ø°Ø§Ù† ØµÙ„Ø§Ø© ${name} Ø§Ù„Ø¢Ù†` }); }, timeout);
        }
    }

    async function loadSurah(num) {
        if(!num) return;
        const audioUrl = `https://download.quranicaudio.com/quran/abdul_basit_murattal/${num.padStart(3, '0')}.mp3`;
        const textKey = `surah_text_${num}`;
        document.getElementById('offlineControls').style.display = 'block';
        const cache = await caches.open(CACHE_NAME);
        const cachedAudio = await cache.match(audioUrl);
        const cachedText = localStorage.getItem(textKey);

        if(cachedAudio && cachedText) {
            document.getElementById('dlStatus').innerText = "âœ… Ø§Ù„Ø³ÙˆØ±Ø© Ù…Ø­Ù…Ù„Ø© (Ø£ÙˆÙÙ„Ø§ÙŠÙ†)";
            document.getElementById('dlBtn').style.display = "none";
            renderAyahs(JSON.parse(cachedText));
            setupAudio(audioUrl);
        } else {
            document.getElementById('dlStatus').innerText = "Ù…ØªÙˆÙØ±Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ÙÙ‚Ø·";
            document.getElementById('dlBtn').style.display = "block";
            document.getElementById('dlBtn').onclick = () => downloadFullSurah(num, audioUrl, textKey);
            fetchOnlineText(num);
            setupAudio(audioUrl);
        }
    }

    async function downloadFullSurah(num, audioUrl, textKey) {
        const status = document.getElementById('dlStatus');
        status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
        try {
            const cache = await caches.open(CACHE_NAME);
            await cache.add(audioUrl);
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${num}`);
            const data = await res.json();
            localStorage.setItem(textKey, JSON.stringify(data.data.ayahs));
            status.innerText = "âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù„Ù„Ø£ÙˆÙÙ„Ø§ÙŠÙ†";
            document.getElementById('dlBtn').style.display = "none";
        } catch (e) { status.innerText = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„"; }
    }

    async function fetchOnlineText(num) {
        const content = document.getElementById('quranContent');
        content.innerHTML = '<p style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>';
        try {
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${num}`);
            const data = await res.json();
            renderAyahs(data.data.ayahs);
        } catch(e) { content.innerHTML = '<p style="text-align:center;">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</p>'; }
    }

    function renderAyahs(ayahs) {
        let html = "";
        ayahs.forEach(a => html += `<div class="ayah-card">${a.text} <span style="color:var(--gold); font-size:0.8rem;">ï´¿${a.numberInSurah}ï´¾</span></div>`);
        document.getElementById('quranContent').innerHTML = html;
    }

    function setupAudio(url) {
        document.getElementById('audioPlayerContainer').innerHTML = `<audio controls class="audio-player" src="${url}"></audio>`;
    }

    function updateCalendar() {
        const now = new Date();
        document.getElementById('gregorianDate').innerText = now.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        fetch(`https://api.aladhan.com/v1/gToH?date=${now.getDate()}-${now.getMonth()+1}-${now.getFullYear()}`)
            .then(res => res.json()).then(data => {
                const h = data.data.hijri;
                document.getElementById('hijriDate').innerText = `${h.day} ${h.month.ar} ${h.year} Ù‡Ù€`;
            });
    }

    function loadPrayerTimes() {
        navigator.geolocation.getCurrentPosition(pos => {
            fetch(`https://api.aladhan.com/v1/timings?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&method=4`)
            .then(res => res.json()).then(data => {
                const t = data.data.timings;
                const names = { Fajr: "Ø§Ù„ÙØ¬Ø±", Dhuhr: "Ø§Ù„Ø¸Ù‡Ø±", Asr: "Ø§Ù„Ø¹ØµØ±", Maghrib: "Ø§Ù„Ù…ØºØ±Ø¨", Isha: "Ø§Ù„Ø¹Ø´Ø§Ø¡" };
                let html = '<h3 style="text-align:center; color:var(--gold);">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</h3>';
                for(let key in names) {
                    html += `<div class="prayer-time-card"><span class="prayer-name">${names[key]}</span><span>${t[key]}</span></div>`;
                    scheduleNotification(names[key], t[key]);
                }
                document.getElementById('prayerTimesContainer').innerHTML = html;
            });
        }, () => {
            document.getElementById('prayerTimesContainer').innerHTML = '<p style="text-align:center;">ÙØ¹Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ù…ÙˆØ§Ù‚ÙŠØª</p>';
        });
    }

    async function loadSurahList() {
        try {
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            const select = document.getElementById('surahSelect');
            data.data.forEach(s => select.innerHTML += `<option value="${s.number}">${s.number} - ${s.name}</option>`);
        } catch(e) {}
    }

    function renderSelect() {
        const s = document.getElementById('zikrSelect'); s.innerHTML = '';
        azkarList.forEach((z, i) => s.innerHTML += `<option value="${i}">${z.name}</option>`);
        loadZikr();
    }
    function loadZikr() {
        idx = document.getElementById('zikrSelect').value;
        document.getElementById('display').innerText = azkarList[idx].count;
        document.getElementById('goalDisplay').innerText = `Ø§Ù„Ù‡Ø¯Ù: ${azkarList[idx].goal}`;
    }
    function handleTap() {
        if(azkarList[idx].count < azkarList[idx].goal) {
            azkarList[idx].count++;
            document.getElementById('display').innerText = azkarList[idx].count;
            localStorage.setItem('alrhab_tasbih', JSON.stringify(azkarList));
            if(azkarList[idx].count == azkarList[idx].goal && navigator.vibrate) navigator.vibrate(200);
        }
    }
    function resetCounter() { azkarList[idx].count = 0; document.getElementById('display').innerText = 0; localStorage.setItem('alrhab_tasbih', JSON.stringify(azkarList)); }
    function openModal() { document.getElementById('modal').style.display = 'flex'; }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function addZikr() {
        const n = document.getElementById('nameInp').value;
        const g = document.getElementById('goalInp').value;
        if(n && g) { azkarList.push({name:n, count:0, goal:parseInt(g)}); renderSelect(); closeModal(); }
    }
    function deleteZikr() { if(azkarList.length > 1) { azkarList.splice(idx, 1); localStorage.setItem('alrhab_tasbih', JSON.stringify(azkarList)); renderSelect(); } }

    function setupCompass() {
        window.addEventListener('deviceorientationabsolute', e => {
            if(e.alpha) document.getElementById('compassRing').style.transform = `rotate(${-e.alpha}deg)`;
        });
    }

    init();
</script>
</body>
</html>
